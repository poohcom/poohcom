!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("three")):"function"==typeof define&&define.amd?define(["three"],e):((t=t||self).THREE=t.THREE||{},t.THREE.TextTexture=e(t.THREE))}(this,(function(t){"use strict";function e(){return document.createElement("canvas")}function n(t,e,n,i,r){return[n,i,r,e+"px",t].join(" ")}function i(t,e,i,r){var o=n(t,1,e,i,r);return document.fonts.load(o)}function r(){var t=this;return Promise.resolve().then((function(){if(t.needsRedraw){var e=t.image;if(e){var i=t,r=i.align,o=i.fillStyle,a=i.fontFamily,l=i.fontSize,f=i.fontStyle,s=i.fontVariant,d=i.fontWeight,c=i.height,h=i.lineGap,u=i.lines,v=i.loadFontFace,g=i.padding,p=i.strokeStyle,y=i.strokeWidth;return Promise.resolve().then((function(){return v(a,f,s,d)})).then((function(){var i=e.getContext("2d");i.clearRect(0,0,e.width,e.height),c*=l,h*=l,g*=l,y*=l;var v=n(a,l,f,s,d),_=2*g+y;if(u.length&&(i.font=v,_+=u.map((function(t){return i.measureText(t).width})).reduce((function(t,e){return Math.max(t,e)}))),_&&c){e.width=_,e.height=c,i.font=v,i.textBaseline="top";var m,x=g+y/2;switch(r){case"left":i.textAlign="left",m=x;break;case"right":i.textAlign="right",m=_-x;break;case"center":i.textAlign="center",m=_/2}i.fillStyle=o,i.miterLimit=1,i.lineWidth=y,i.strokeStyle=p,u.forEach((function(t){y&&i.strokeText(t,m,x),i.fillText(t,m,x),x+=l+h}))}else e.width=e.height=1;t.needsRedraw=!1,t.needsUpdate=!0}))}}}))}var o=function(n){function o(o){void 0===o&&(o={});var a=o.align;void 0===a&&(a="center");var l=o.createCanvas;void 0===l&&(l=e);var f=o.fillStyle;void 0===f&&(f="#fff");var s=o.fontFamily;void 0===s&&(s="sans-serif");var d=o.fontSize;void 0===d&&(d=16);var c=o.fontStyle;void 0===c&&(c="normal");var h=o.fontVariant;void 0===h&&(h="normal");var u=o.fontWeight;void 0===u&&(u="normal");var v=o.lineGap;void 0===v&&(v=.15);var g=o.loadFontFace;void 0===g&&(g=i);var p=o.padding;void 0===p&&(p=.25);var y=o.strokeStyle;void 0===y&&(y="#000");var _=o.strokeWidth;void 0===_&&(_=0);var m,x,S,k,w,F=o.text;void 0===F&&(F=""),n.call(this,l(),void 0,void 0,void 0,t.LinearFilter,t.LinearFilter),Object.assign(this,{_align:a,_fillStyle:f,_fontFamily:s,_fontSize:d,_fontStyle:c,_fontVariant:h,_fontWeight:u,_lineGap:v,_padding:p,_strokeStyle:y,_strokeWidth:_,_text:F,createCanvas:l,loadFontFace:g,needsRedraw:!0,redraw:(m=r,x=1,w=Promise.resolve(),function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return S=m.bind.apply(m,[this].concat(t)),k||(k=new Promise((function(t,e){w.finally((function(){setTimeout((function(){Promise.resolve().then((function(){try{return S()}finally{w=k,k=null}})).then(t).catch(e)}),x)}))}))),k})}),this.redraw()}n&&(o.__proto__=n),o.prototype=Object.create(n&&n.prototype),o.prototype.constructor=o;var a={lines:{configurable:!0},height:{configurable:!0}};return a.lines.get=function(){var t=this.text;return t?t.split("\n"):[]},a.height.get=function(){var t=this.lineGap,e=this.lines,n=2*this.padding+this.strokeWidth;return e.length&&(n+=e.length+t*(e.length-1)),n},Object.defineProperties(o.prototype,a),o}(t.Texture);return Object.entries({_align:"align",_fillStyle:"fillStyle",_fontFamily:"fontFamily",_fontSize:"fontSize",_fontStyle:"fontStyle",_fontVariant:"fontVariant",_fontWeight:"fontWeight",_lineGap:"lineGap",_padding:"padding",_strokeStyle:"strokeStyle",_strokeWidth:"strokeWidth",_text:"text"}).forEach((function(t){var e=t[0],n=t[1];Object.defineProperty(o.prototype,n,{get:function(){return this[e]},set:function(t){this[e]!==t&&(this[e]=t,this.needsRedraw=!0,this.redraw())}})})),o.prototype.isTextTexture=!0,o}));